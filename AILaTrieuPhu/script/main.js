var listAllQuestion = [{
        question: "Ba thương con vì con giống mẹ, mẹ thương con vì con giông ai ?",
        answers: [
            "Ba",
            "Bác hàng xóm",
            "Thợ sửa ông nước",
            "Thợ điện"
        ],
        toAnswer: "Ba",
    },
    {
        question: "Chất khí không hoặc rất ít tác dụng với khí khác gọi là gì?",
        answers: [
            "Khí trơ",
            "Khí nén",
            "Khí hiếm",
            "Khí thơm"
        ],
        toAnswer: "Khí trơ",
    },
    {
        question: "Quốc khánh nước Cộng hoà xã hội chủ nghĩa Việt Nam?",
        answers: [
            "30.04",
            "02.09",
            "14.02",
            "09.02"
        ],
        toAnswer: "02.09",
    },
    {
        question: "Kết nối sức mạnh là khẩu hiệu của mạng di động nào nước ta?",
        answers: [
            "Viettel",
            "Vinaphone",
            "EVN",
            "Sfone"
        ],
        toAnswer: "EVN",
    },
    {
        question: "Trong các nhân vật sau đây, nhân vật nào thuộc bộ truyện tranh Đôrêmon?",
        answers: [
            "Cađic",
            "Sôngôku",
            "Chaien",
            "Bumma"
        ],
        toAnswer: "Chaien",
    },
    {
        question: "Thứ tự nào sau đây đúng với một câu thành ngữ?",
        answers: [
            "Tre mọc măng già",
            "Tre già măng mọc",
            "Măng mọc tre già",
            "Măng già tre học"
        ],
        toAnswer: "Tre già măng mọc",
    },
    {
        question: "Đâu là tên một lọai bóng",
        answers: [
            "Giường",
            "Tủ",
            "Bàn",
            "Ghế"
        ],
        toAnswer: "Bàn",
    },
    {
        question: "Bức tranh 'Thiếu nữ bên hoa huệ' của tác giả nào?",
        answers: [
            "Trần Văn Cẩn",
            "Tô Ngọc Vân",
            "Bùi Xuân Phái",
            "Nguyễn Sáng"
        ],
        toAnswer: "Tô Ngọc Vân",
    },
    {
        question: "Đơn vị đo cường độ dòng điện là gì?",
        answers: [
            "Ampe",
            "Vôn",
            "Ôm",
            "Mét"
        ],
        toAnswer: "Ampe",
    },
    {
        question: "Theo cấu trúc phân tầng thì rừng tự nhiên được chia làm mấy tầng?",
        answers: [
            "2",
            "3",
            "4",
            "5"
        ],
        toAnswer: "3",
    },
    {
        question: "Windows Media Player là gì?",
        answers: [
            "Phần mềm chỉnh nhạc",
            "Phần mềm ghép nhạc",
            "Phần mềm nghe nhạc",
            "Phần mềm tách nhạc"
        ],
        toAnswer: "Phần mềm nghe nhạc",
    },
    {
        question: "Quốc kì của cộng hòa liên bang Đức có bao nhiêu màu?",
        answers: [
            "2",
            "3",
            "4",
            "5"
        ],
        toAnswer: "3",
    },
    {
        question: "Lông gấu trắng Bắc cực có màu gì",
        answers: [
            "Trắng",
            "Vàng nhạt",
            "Đen",
            "Trong suốt"
        ],
        toAnswer: "Trong suốt",
    },
    {
        question: "Cầu thang lên chùa Một cột hiện nay làm bằng gì?",
        answers: [
            "Gỗ",
            "Tre",
            "Gạch, vữa",
            "Bê Tông"
        ],
        toAnswer: "Gạch, vữa",
    },
    {
        question: "Thành phần chính của Cát là gì?",
        answers: [
            "Si",
            "Au",
            "Al",
            "Cu"
        ],
        toAnswer: "Si",
    },
    {
        question: "Bạn cho biết vua Lê nào được lịch sử tôn làm anh hùng?",
        answers: [
            "Lê Hiền Tông",
            "Lê Chiêu Tông",
            "Lê Thái Tổ",
            "Lê Thánh Tông"
        ],
        toAnswer: "Lê Thái Tổ",
    },
    {
        question: "Hoàng cung Diocletian, 1 kỳ quan thế giới nằm ở quốc gia nào?",
        answers: [
            "Nam Phi",
            "Nam Tư",
            "Ấn Độ",
            "Pakistan"
        ],
        toAnswer: "Nam Tư",
    },
    {
        question: "Quốc tế thứ II còn có tên gọi khác là gì?",
        answers: [
            "Quốc tế Cộng Sản",
            "Quốc tế XHCN",
            "Đồng Minh những người Cộng Sản",
            "Hội Liên Hiệp Quốc tế những người Lao động"
        ],
        toAnswer: "Quốc tế XHCN",
    },
    {
        question: "Năm 1924 khi rời Liên Xô sang Quảng Châu Trung Quốc, Nguyễn Ái Quốc lấy tên gì?",
        answers: [
            "Tống Văn Sơ",
            "Lý Thuỵ",
            "Nguyễn Tất Thành",
            "Hồ Chí Minh"
        ],
        toAnswer: "Lý Thuỵ",
    },
    {
        question: "Nền văn minh nào là phát triển nhất trong lich sử đất nước Mexico?",
        answers: [
            "Maya",
            "Aztec",
            "Inca",
            "Olmec"
        ],
        toAnswer: "Aztec",
    },
    {
        question: "Ngành được xem là thước đo trình độ phát triển kinh tế  kỹ thuật của mọi quốc gia trên thế giới là ngành công nghiệp nào trong các ngành sau?",
        answers: [
            "Năng lượng",
            "Luyện kim",
            "Cơ khí",
            "Điện tử  Tin học"
        ],
        toAnswer: "Điện tử  Tin học",
    },
    {
        question: "Đất nước nào được mệnh danh là 'Đất nước Triệu Voi'?",
        answers: [
            "Trạng Quỳnh",
            "Trạng Trình",
            "Trạng Lường",
            "Trạng Lợn"
        ],
        toAnswer: "Trạng Lường",
    },
    {
        question: "Trong thần thoại Hy Lạp, người anh hùng nào đã lấy cắp lửa của thân linh cho loài người?",
        answers: [
            "Akhil",
            "Hecculơ",
            "Thêxê",
            "Prômêtê"
        ],
        toAnswer: "Prômêtê",
    },
    {
        question: "Nhạc sĩ nào có tác phẩm được dịch ra tiếng nước ngoài nhiều nhất?",
        answers: [
            "Trần Tiến",
            "Trần Hiếu",
            "Trịnh Công Sơn",
            "Duy Mạnh"
        ],
        toAnswer: "Duy Mạnh",
    },
    {
        question: "Quốc gia nào ở Châu Phi có tỉ lệ người da trắng xấp xỉ tỉ lệ người da đen?",
        answers: [
            "Ai Cập",
            "Ma Rốc",
            "Nam Phi",
            "Madagascar"
        ],
        toAnswer: "MadagascarPhần 1 và 2 của bộ phim Harry Potter do ai đạo diễn?",
        answers: [
            "Christina Anguilera",
            "James Cameron",
            "Scorpions",
            "Madagascar"
        ],
        toAnswer: "Scorpions",
    },
    {
        question: "Which CSS property is used to change the text color of an element?",
        answers: ["fgcolor", "text-color", "color", "..."],
        toAnswer: "color",
    },
    {
        question: "Which CSS property controls the text size?",
        answers: ["font-size", "text-style", "font-style", "text-size"],
        toAnswer: "font-size",
    },
    {
        question: "What is the correct CSS syntax for making all the <p> elements bold?",
        answers: [
            "<p style='font-size:bold;'>",
            "<p style='text-size:bold;'>",
            "p {text-size:bold;}",
            "p {font-weight:bold;}",
        ],
        toAnswer: "p {font-weight:bold;}  ",
    },
    {
        question: "How do you display hyperlinks without an underline?",
        answers: [
            "a {underline:none;}",
            "a {text-decoration:no-underline;}",
            "a {text-decoration:none;}",
            "a {decoration:no-underline;}",
        ],
        toAnswer: "a {text-decoration:none;}",
    },
    {
        question: "How do you make each word in a text start with a capital letter?",
        answers: [
            "text-style:capitalize",
            "transform:capitalize",
            "You can't do that with CSS",
            "text-transform:capitalize",
        ],
        toAnswer: "text-transform:capitalize",
    },
];
var currentQuestion = 0;

const timer = document.querySelector("#timer");
const contentQuestion = document.querySelector(".content__question");
const cardMoney = document.querySelectorAll(".money__card");
const question = document.getElementById("question");
const listAnswerCard = document.querySelectorAll(".answer__card");
const listAnswer = document.querySelectorAll(".answer");
const submitAnswer = document.querySelector(".submit-answer");
const btnSubmit = document.querySelector(".submit-answer button");
const help = document.querySelectorAll(".help__icon img");
const listMoneyIcon = document.querySelectorAll(".money__icon");

const modal = document.querySelector(".modal");
const modalText = document.querySelector("#modal-text");
const btnResetGame = document.querySelector("#btn-reset");
const btnExitGame = document.querySelector("#btn-exit");
var initGameMoneyInter;
var answerRight = "";
var indexAnswerRight = -1;
var clickSubmit = false;
var listQuestion = [];
var listIndexQuestion = [];




const listMoneys = [
    "200",
    "400",
    "600",
    "1.000",
    "2.000",
    "3.000",
    "6.000",
    "10.000",
    "14.000",
    "22.000",
    "30.000",
    "40.000",
    "60.000",
    "85.000",
    "150.000",
];

function initGame() {
    let index = 15;
    let count = 1;
    initGameMoneyInter = setInterval(function() {
        index--;
        if (index >= 0) {
            cardMoney[index].classList.add("money__current");
            if (index < 14) {
                cardMoney[index + 1].classList.remove("money__current");
            }
        } else if (count > 0) {
            count--;
            index = 14;
            cardMoney[14].classList.add("money__current");
            cardMoney[0].classList.remove("money__current");
        } else {
            cardMoney[0].classList.remove("money__current");
            return;
        }
    }, 200);
}

function getListQuestion() {
    for (let i = 0; i < 16; i++) {
        let index = Math.floor(Math.random() * listAllQuestion.length);
        if (listIndexQuestion.indexOf(index) > -1) {
            i--;
            continue;
        }
        listIndexQuestion.push(index);
        listQuestion.push(listAllQuestion[index]);
    }
}

function showQuestion(index) {

    let objCurrentQuestion = listQuestion[index];

    objCurrentQuestion.answers.sort((a, b) => 0.5 - Math.random());

    // show text
    question.textContent = objCurrentQuestion.question;
    listAnswer.forEach((answer, i) => {
        answer.textContent = objCurrentQuestion.answers[i];
        if (answer.textContent === objCurrentQuestion.toAnswer) {
            answerRight = answer.parentNode;
            indexAnswerRight = i;
        }
    });
}

function resetAll() {
    // restart money list
    clearInterval(initGameMoneyInter);
    cardMoney.forEach((card) => card.classList.remove("money__current"));
    for (
        let i = listMoneyIcon.length - currentQuestion - 1; i < listMoneyIcon.length; i++
    ) {
        listMoneyIcon[i].style.visibility = "hidden";
    }

    // restart help
    help[0].setAttribute("src", "images/5050.png");
    help[1].setAttribute("src", "images/call.png");
    help[2].setAttribute("src", "images/hoikhangia.png");
    help[3].setAttribute("src", "images/tuvantaicho.png");
    help.forEach((helper) => (helper.className = ""));
}

function showModal(index) {
    modal.style.display = "block";
    let kq = "Bạn không trả lời đúng câu hỏi nào.";
    if (index) {
        kq =
            "Bạn đã chiến thắng trò chơi với phần thưởng " +
            listMoneys[index - 1] +
            ".000 đ";
    }
    modalText.textContent = kq;
}

function clearAnswerPlayer() {
    listAnswerCard.forEach((answer) => {
        answer.classList.remove("answer__player", "answer--right");
    });
}

function timesToAnswer() {
    let i = 30;
    timer.textContent = 30;
    timer.style.display = "block";

    let inter = setInterval(function() {
        if (i === 0 || clickSubmit) {
            clearInterval(inter);
            console.log("clear");

            return;
        }
        i--;
        timer.textContent = i;
    }, 1000);
    setTimeout(() => {
        if (i === 0) {
            submitAnswer.style.opacity = 0;
            runAudio("../audio/end-time.ogg", true);
            alert("Ban da het thoi gian de tra loi cau hoi");
            alert("Ban dung lai voi " + currentQuestion + " cau hoi");
            resetAll();
            currentQuestion = 0;

            contentQuestion.style.display = "none";
            times.style.display = "none";
        }
    }, 30500);
}

listAnswerCard.forEach((answer) => {
    answer.addEventListener("click", function() {
        clearAnswerPlayer();
        answer.classList.add("answer__player");
        // submitAnswer.style.display = "block";
        submitAnswer.style.opacity = 1;
    });
});

function clearTwoAnswer() {

    let answerNoClear = -1;
    do {
        answerNoClear = Math.floor(Math.random() * 4);
    } while (answerNoClear === indexAnswerRight);

    // clear two answer rest
    listAnswer.forEach((answer, i) => {
        if (i !== indexAnswerRight && i !== answerNoClear) {
            answer.textContent = "";
        }
    });
}

window.onload = function() {
    initGame();
    getListQuestion();
    clearInterval(initGameMoneyInter);
    cardMoney.forEach((card) => card.classList.remove("money__current"));
    showQuestion(currentQuestion);

    help.forEach((helper) => (helper.className = "still"));
    clickSubmit = false;
    timesToAnswer();
};

help.forEach((helper, i) => {
    helper.addEventListener("click", function() {
        if (helper.className === "still") {
            switch (i) {
                case 0:
                    clearTwoAnswer();
                    helper.setAttribute("src", "images/5050_used.png");
                    break;
                case 1:
                    helper.setAttribute("src", "images/call_used.png");
                    break;
                case 2:
                    helper.setAttribute("src", "images/hoikhangia_used.png");
                    break;
                case 3:
                    helper.setAttribute("src", "images/tuvantaicho_used.png");
                    break;
            }
            helper.className = "";
        }
    });
});
btnSubmit.addEventListener("click", function() {
    let answerOfPlayer = document.querySelector(".answer__player .answer")
        .textContent;
    answerRight.classList.add("answer--right");
    clickSubmit = true;
    submitAnswer.style.opacity = 0;
    if (answerOfPlayer === listQuestion[currentQuestion].toAnswer) {
        let index = 14 - currentQuestion;

        listMoneyIcon[index].style.visibility = "visible";
        cardMoney[index].classList.add("money__current");
        if (currentQuestion !== 0) {
            cardMoney[index + 1].classList.remove("money__current");
        }
        if (currentQuestion === listQuestion.length - 1) {

            setTimeout(function() {
                // show modal
                showModal(currentQuestion);

                timer.style.display = "none";
                resetAll();
                audio.pause();
            }, 1500);
        } else {

            setTimeout(() => {
                currentQuestion++;
                showQuestion(currentQuestion);
                clickSubmit = false;
                timesToAnswer();

            }, 2500);
        }
    } else {

        setTimeout(function() {
            showModal(currentQuestion);
            resetAll();
            currentQuestion = 0;

            timer.style.display = "none";
            console.log("end");
        }, 2500);
    }
    setTimeout(clearAnswerPlayer, 2500);
});
btnExitGame.addEventListener("click", function() {
    window.location.href = "index.html";
});

// event play again game
btnResetGame.addEventListener("click", function() {

    window.location.reload();


});